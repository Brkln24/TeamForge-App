<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeamForge - Basketball Manager</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">

    <!-- Modern Firebase v12+ Modular SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getFirestore, connectFirestoreEmulator } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
        import { getAuth, connectAuthEmulator } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

        // Your TeamForge Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCrAPyjI91mdpOXgrUO6vKP83TbhMfQGKI",
            authDomain: "teamforgeproject-37f27.firebaseapp.com",
            projectId: "teamforgeproject-37f27",
            storageBucket: "teamforgeproject-37f27.firebasestorage.app",
            messagingSenderId: "625240400602",
            appId: "1:625240400602:web:c24e30c9ba4f28b0bafbe3",
            measurementId: "G-V2GBMH5H88"
        };

        try {
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const auth = getAuth(app);
            
            // Make Firebase available globally for testing
            window.firebaseApp = app;
            window.firebaseDB = db;
            window.firebaseAuth = auth;
            window.firebaseConfig = firebaseConfig;
            
            console.log('üî• Firebase v12+ initialized successfully');
            console.log('üìä Project ID:', firebaseConfig.projectId);
            
            // Mark Firebase as loaded
            window.firebaseLoaded = true;
            
        } catch (error) {
            console.error('‚ùå Firebase initialization failed:', error);
            window.firebaseError = error;
        }
    </script>
</head>
<body>
    <div id="app">
        <header class="header">
            <nav class="navbar">
                <!-- Navigation will be populated by JavaScript -->
            </nav>
        </header>

        <main class="main-content">
            <div class="container">
                <!-- Home Page Dashboard -->
                <div id="dashboard-content">
                    <!-- This will be populated by JavaScript -->
                </div>
            </div>
        </main>
    </div>

    <script src="js/database.js"></script>
    <script src="js/modern-firebase-adapter.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Check if user is logged in, redirect to landing if not
        document.addEventListener('DOMContentLoaded', () => {
            // Wait for database to initialize
            const checkAuth = () => {
                if (window.db) {
                    console.log('üîç Database available, checking authentication...');
                    console.log('üìä Database type:', window.db.constructor.name);
                    
                    const currentUser = window.db.getCurrentUser();
                    if (!currentUser) {
                        console.log('üîì No user logged in, redirecting to landing page');
                        window.location.href = 'landing.html';
                        return;
                    }
                    
                    console.log('‚úÖ User authenticated:', currentUser.email || currentUser.username);
                    
                    // User is logged in, proceed with dashboard
                    if (window.app) {
                        const container = document.getElementById('dashboard-content');
                        if (container) {
                            console.log('üìä Loading dashboard...');
                            window.app.loadDashboard(container);
                        } else {
                            console.error('‚ùå Dashboard container not found');
                        }
                    } else {
                        console.warn('‚ö†Ô∏è App not initialized yet, retrying...');
                        setTimeout(checkAuth, 100);
                    }
                } else {
                    // Database not ready, retry after short delay
                    console.log('‚è≥ Database not ready, retrying...');
                    setTimeout(checkAuth, 100);
                }
            };
            
            // Add a longer initial delay to ensure all scripts load
            setTimeout(checkAuth, 1000);
        });
    </script>
</body>
</html>